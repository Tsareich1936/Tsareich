###########################
# Spanish Events
###########################

add_namespace = TR_spain

# Spanish Civil War
country_event = {
	id = TR_spain.1
	title = TR_spain.1.t
	desc = TR_spain.1.d
	picture = GFX_report_event_spain_civil_war_soldiers

	fire_only_once = yes

	trigger = {
		tag = SPR
		has_defensive_war = no
		date > 1936.2.16 # Trigger at some point after 1936 elections
	}

	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		hidden_effect = {
			SPR = {
				load_focus_tree = SPR_foucs
				every_core_state = {
					add_core_of = SPA
					add_core_of = SPB
					add_core_of = SPC
					add_core_of = SPD
				}
			}
            169  = { transfer_state_to = SPA }
			171  = { transfer_state_to = SPA }
			170  = { transfer_state_to = SPA }
			789  = { transfer_state_to = SPA }
			290  = { transfer_state_to = SPA }
			699  = { transfer_state_to = SPA }
			declare_war_on = {
				target = SPA
				type = civil_war
			}
			SPA = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				load_focus_tree = SPR_foucs
				every_owned_state = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPA
					}
				}
				171= {
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
				}
				290= {
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5"
						owner = SPA
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
					create_unit = {
						division = "name = \División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
				}
				169= {
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5"
						owner = SPA
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPA
					}
				}

			}
			set_global_flag = TR_spr_civ_war
		}
	}

	option = { # Support Nationalists
		name = TR_spain.1.a
		trigger = { is_ai = no }
		hidden_effect = {
		}
		custom_effect_tooltip = nationalists_chosen
	}
	option = { # Support Republicans
		name = TR_spain.1.b
		hidden_effect = {
		}
		custom_effect_tooltip = republicans_chosen
	}
}





country_event = {
	id = TR_spain.2
	title = TR_spain.2.t
	desc = TR_spain.2.d
	picture = GFX_report_event_spain_civil_war_soldiers

	fire_only_once = yes

	trigger = {
		tag = SPR
		has_global_flag = TR_spr_civ_war
		date > 1936.3.16 # Trigger at some point after 1936 elections
	}

	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		hidden_effect = {
            176  = { transfer_state_to = SPB }
			791  = { transfer_state_to = SPB }
			172  = { transfer_state_to = SPC }
			1041  = { transfer_state_to = SPC }
			1044  = { transfer_state_to = SPC }
			167  = { transfer_state_to = SPD }
			794  = { transfer_state_to = SPD }
			1043  = { transfer_state_to = SPD }
			165  = { transfer_state_to = CAT }
			792  = { transfer_state_to = NAV }
			SPR = {
				add_ideas = TR_SPR_no_morale
			every_owned_state = {
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = SPR
				}
			}
			}
			
			SPA = {
				add_ideas = TR_SPR_civwar
				load_focus_tree = SPR_foucs
				declare_war_on = {
					target = SPB
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
				declare_war_on = {
					target = CAT
					type = civil_war
				}
				declare_war_on = {
					target = NAV
					type = civil_war
				}
			}
			SPB = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				add_manpower = 70000
				every_owned_state = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPB
					}
				}
				declare_war_on = {
					target = SPR
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
				declare_war_on = {
					target = CAT
					type = civil_war
				}
			}
			SPC = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_inter_war
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				load_focus_tree = SPR_foucs
				add_manpower = 100000
				every_owned_state = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPC
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPC
					}
				}
				declare_war_on = {
					target = SPR
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
				declare_war_on = {
					target = CAT
					type = civil_war
				}
				declare_war_on = {
					target = NAV
					type = civil_war
				}
			}
			SPD = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				load_focus_tree = SPR_foucs
				every_owned_state = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
				}
				1043 = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPD
					}
				}
				declare_war_on = {
					target = SPR
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
				declare_war_on = {
					target = CAT
					type = civil_war
				}
				declare_war_on = {
					target = NAV
					type = civil_war
				}
			}
			NAV = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				load_focus_tree = SPR_foucs
				792 = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = NAV
					}
				}
				declare_war_on = {
					target = SPR
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
			}
			CAT = {
			set_rule = {
				can_join_factions = no
			}
			add_ideas = TR_SPR_civwar
			add_ideas = war_economy
			add_ideas = extensive_conscription
			load_focus_tree = SPR_foucs
			165 = {
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
					owner = CAT
				}
				create_unit = {
					division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
					owner = CAT
				}
			}
				declare_war_on = {
					target = SPR
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
			}
		}
	}

	option = { # Support Nationalists
		name = TR_spain.2.a
		trigger = { is_ai = no }
		hidden_effect = {
		}
		custom_effect_tooltip = nationalists_chosen
	}
	option = { # Support Republicans
		name = TR_spain.2.b
		hidden_effect = {
			
		}
		custom_effect_tooltip = republicans_chosen
	}
}



country_event = {
	id = TR_spain.3
	title = TR_spain.3.t
	desc = TR_spain.3.d
	picture = GFX_report_event_spain_civil_war_soldiers

	fire_only_once = yes

	trigger = {
		tag = SPR
		has_global_flag = TR_spr_civ_war
		date > 1936.4.6 # Trigger at some point after 1936 elections
	}

	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		hidden_effect = {
			SPR = {
				every_core_state = {
					add_core_of = SPE
				}
			}
            175  = { transfer_state_to = SPE }
			1042  = { transfer_state_to = SPE }
			declare_war_on = {
				target = SPE
				type = civil_war
			}
			SPA = {
				declare_war_on = {
					target = SPE
					type = civil_war
				}
			}	
			SPE = {
				set_rule = {
					can_join_factions = no
				}
				add_ideas = TR_SPR_civwar
			    add_ideas = war_economy
				add_ideas = extensive_conscription
				load_focus_tree = SPR_foucs
				every_owned_state = {
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"SPR milicia\" division_template = \"SPR milicia\" start_experience_factor = 0.3" 
						owner = SPE
					}
				}
				175= {
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPE
					}
					create_unit = {
						division = "name = \"División de Infantería\" division_template = \"División de Infantería\" start_experience_factor = 0.5" 
						owner = SPE
					}
				}
				declare_war_on = {
					target = SPB
					type = civil_war
				}
				declare_war_on = {
					target = SPC
					type = civil_war
				}
				declare_war_on = {
					target = SPD
					type = civil_war
				}
				declare_war_on = {
					target = NAv
					type = civil_war
				}
				declare_war_on = {
					target = CAT
					type = civil_war
				}
			}
		}

		
	}
	option = { # Support Nationalists
		    name = TR_spain.3.a
		    trigger = { is_ai = no }
		    hidden_effect = {
		    }
		    custom_effect_tooltip = nationalists_chosen
	    }
	    option = { # Support Republicans
		    name = TR_spain.3.b
		    hidden_effect = {
			
		    }
		    custom_effect_tooltip = republicans_chosen
	    }
}
country_event = {
	id = spain.1
	title = spain.1.t
	desc = spain.1.d
	picture = GFX_report_event_spain_civil_war_soldiers

	fire_only_once = yes

	trigger = {
		always = no
	}

	mean_time_to_happen = {
		days = 1
	}
	option = { # Support Nationalists
		name = spain.1.a
		trigger = { is_ai = no }
		hidden_effect = {
			set_capital = { state = 176 }
			start_civil_war = {
                ruling_party = fascism
				ideology = communism
				size = 0.5
				capital = 41
				states = { 41 165 167 168 173 175 790 792 793 794 }
				
			}
			random_other_country = {
				limit = {
					original_tag = SPR
					has_government = communism
				}
				load_oob = "SPR_Civil_War"
				set_equipment_fraction = 0.5
				set_stability = 0.9
				set_war_support = 0.8
				#country_event = { id = spain.3 days = 1 }
				add_popularity = {
					ideology = democratic
					popularity = 0.35
				}
			}
			# news_event = { hours = 6 id = news.63 }
			set_global_flag = spanish_civil_war
			set_country_flag = scw_no_lar_nationalists

			load_oob = "SPA_Civil_War"
			set_equipment_fraction = 0.5
			set_stability = 0.9
			set_war_support = 0.8

			add_popularity = {
				ideology = fascism
				popularity = 1
			}
			random_other_country = {
				limit = {
					original_tag = SPR
					has_government = communism
				}
				set_cosmetic_tag = SPR_civil_war
				set_country_flag = scw_no_lar_republicans
			}

			#country_event = { id = spain.2 days = 7 }
		}
		custom_effect_tooltip = nationalists_chosen
	}
	option = { # Support Republicans
		name = spain.1.b
		hidden_effect = {
			start_civil_war = {
				ideology = fascism
				size = 0.5
				capital = 176
				states = { 166 169 170 171 172 174 176 177 178 290 297 699 788 789 791 }
			}
			random_other_country = {
				limit = {
					original_tag = SPR
					has_government = fascism
				}
				set_equipment_fraction = 0.5
				set_stability = 0.9
				set_war_support = 0.8
				#country_event = { id = spain.2 days = 1 }
				load_oob = "SPA_Civil_War"
			}
			# news_event = { hours = 6 id = news.63 }
			set_global_flag = spanish_civil_war
			set_country_flag = scw_no_lar_republicans

			set_politics = {
				ruling_party = socialdemocratic
				elections_allowed = no
			}
			add_popularity = {
				ideology = socialdemocratic
				popularity = 0.5
			}
			add_popularity = {
				ideology = fascism
				popularity = -1
			}
			random_other_country = {
				limit = {
					original_tag = SPR
					has_government = fascism
				}
				set_cosmetic_tag = SPR_civil_war
				set_country_flag = scw_no_lar_nationalists
			}
			load_oob = "SPR_Civil_War"
			set_equipment_fraction = 0.5
			set_stability = 0.9
			set_war_support = 0.8

			#country_event = { id = spain.3 days = 7 }
		}
		custom_effect_tooltip = republicans_chosen
	}
}



# Civil war over. Move Capital
country_event = {
	id = TR_spain.8
	title = TR_spain.8.t
	desc = TR_spain.8.d
	picture = GFX_report_event_spain_civil_war_volunteers_01

	trigger = {
		original_tag = SPR
		not = { has_government = socialdemocratic }
		has_global_flag = nationalist_victory
		owns_state = 41
		NOT = {
			41 = { is_capital = yes }
		}
	}

	fire_only_once = yes

	mean_time_to_happen = {
		days = 2
	}

	option = {
		ai_chance = { factor = 1 }
		name = spain.8.a
		set_capital = { state = 41 }
	}
	option = {
		ai_chance = { factor = 0 }
		name = spain.8.b
	}
}
